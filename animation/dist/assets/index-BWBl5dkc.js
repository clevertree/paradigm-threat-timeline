(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const e of o.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&r(e)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();const ge="modulepreload",ve=function(i){return"/"+i},ne={},pe=function(n,t,r){let a=Promise.resolve();if(t&&t.length>0){let e=function(y){return Promise.all(y.map(S=>Promise.resolve(S).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),s=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));a=e(t.map(y=>{if(y=ve(y),y in ne)return;ne[y]=!0;const S=y.endsWith(".css"),m=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${m}`))return;const c=document.createElement("link");if(c.rel=S?"stylesheet":ge,S||(c.as="script"),c.crossOrigin="",c.href=y,s&&c.setAttribute("nonce",s),document.head.appendChild(c),S)return new Promise((v,x)=>{c.addEventListener("load",v),c.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${y}`)))})}))}function o(e){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=e,window.dispatchEvent(d),!d.defaultPrevented)throw e}return a.then(e=>{for(const d of e||[])d.status==="rejected"&&o(d.reason);return n().catch(o)})},ce=[{year:-5e3,title:"Before Creation",type:"planetary",phase:"before-creation"},{year:-4077,title:"Proto-Saturn joins Sun's orbit — Golden Age begins",type:"planetary",phase:"golden-age"},{year:-3147,title:"Golden Age ends violently — collinear configuration breaks",type:"planetary",phase:"dark-age"},{year:-3067,title:"Planets are at war — Jupiter assaults Saturn",type:"planetary",phase:"dark-age"},{year:-2860,title:"Non-linear 'Round Table' orbit stabilizes",type:"planetary",phase:"dark-age"},{year:-2349,title:"Jupiter disappears — Venus attacks Earth (Deluge)",type:"planetary",phase:"dark-age"},{year:-2193,title:"Earth leaves last Absu layer — Jupiter consumes Venus",type:"planetary",phase:"dark-age"},{year:-1936,title:"Sodom & Gomorrah destroyed by Mars",type:"planetary",phase:"dark-age"},{year:-1492,title:"Passover of Comet Venus — Exodus",type:"planetary",phase:"dark-age"},{year:-1442,title:"Sun stands still for Joshua",type:"planetary",phase:"dark-age"},{year:-806,title:"Mars, Earth, Mercury finalize orbits",type:"planetary",phase:"dark-age"},{year:-670,title:"Priori-Mars loses outer shell — Iron Age begins",type:"planetary",phase:"dark-age"},{year:-684,title:"Solar system becomes stable",type:"planetary",phase:"stability"},{year:-670,endYear:1053,title:"The Blip: 7th c. BCE to 10th c. CE never occurred (Fomenko)",type:"blip",phase:"blip"},{year:1053,title:"'Year of our Lord' Deception — 1053-year shift",type:"map",lat:41.01,lng:28.98,chapter:"05",phase:"empire-formation"},{year:1053,title:"Deep State centralizes world religion at Jerusalem",type:"map",lat:31.77,lng:35.23,chapter:"05",phase:"empire-formation"},{year:1152,title:"Historical Christ born in Crimea",type:"map",lat:44.95,lng:34.1,chapter:"06",phase:"empire-formation"},{year:1185,title:"Historical Christ crucified in Istanbul",type:"map",lat:41.01,lng:28.98,chapter:"06",phase:"empire-formation"},{year:1196,title:"First Crusade / Trojan War (revenge for Christ)",type:"map",lat:39.96,lng:26.24,chapter:"06",phase:"empire-formation"},{year:1200,title:"Russian Horde 'Tartarian' Empire emerges",type:"map",lat:55.75,lng:37.62,chapter:"07",phase:"empire-formation"},{year:1258,title:"Historical Christ dies",type:"map",lat:41.01,lng:28.98,chapter:"07",phase:"empire-formation"},{year:1285,title:"First Olympic Games",type:"map",lat:37.64,lng:21.63,chapter:"07",phase:"empire-formation"},{year:1300,title:"Great Expansion of Mongol-Slavic Horde",type:"map",lat:55.75,lng:37.62,chapter:"08",phase:"peak-empire"},{year:1380,title:"Battle of Kulikovo — Giants defeated",type:"map",lat:53.67,lng:38.67,chapter:"08",phase:"peak-empire"},{year:1421,title:"Meteorite falls on Yaroslavl",type:"map",lat:57.63,lng:39.87,chapter:"09",phase:"fragmentation"},{year:1431,title:"Jeanne d'Arc executed (Fomenko: ~1580)",type:"map",lat:49.44,lng:1.1,chapter:"09",phase:"fragmentation"},{year:1453,title:"Fall of Czar-Grad (Constantinople)",type:"map",lat:41.01,lng:28.98,chapter:"09",phase:"fragmentation"},{year:1455,title:"Gutenberg Bible translated into Latin",type:"map",lat:49.99,lng:8.27,chapter:"09",phase:"fragmentation"},{year:1486,title:"Revelation of the coming Apocalypse",type:"map",lat:41.9,lng:12.5,chapter:"09",phase:"fragmentation"},{year:1492,title:"The Apocalypse Crusade",type:"map",lat:37.39,lng:-5.98,chapter:"09",phase:"fragmentation"},{year:1517,title:"Protestant Reformation begins",type:"map",lat:51.87,lng:12.64,chapter:"10",phase:"religious-schism"},{year:1523,title:"Jesuits 'Pilgrimage' to Palestine",type:"map",lat:31.77,lng:35.23,chapter:"10",phase:"religious-schism"},{year:1542,title:"The Holy Inquisition",type:"map",lat:41.9,lng:12.5,chapter:"10",phase:"religious-schism"},{year:1548,title:"Jesuits reach Africa",type:"map",lat:9.03,lng:38.74,chapter:"10",phase:"religious-schism"},{year:1552,title:"Khazar Rebellion in Rus-Horde Empire",type:"map",lat:55.79,lng:49.11,chapter:"10",phase:"religious-schism"},{year:1565,title:"Oprichnina coup (Romanov dynasty)",type:"map",lat:55.75,lng:37.62,chapter:"10",phase:"religious-schism"},{year:1582,title:"Gregorian Calendar introduced",type:"map",lat:41.9,lng:12.5,chapter:"10",phase:"religious-schism"},{year:1611,title:"King James Bible published",type:"map",lat:51.51,lng:-.13,chapter:"11",phase:"romanov-split"},{year:1613,title:"Romanov dynasty takes the throne",type:"map",lat:55.75,lng:37.62,chapter:"11",phase:"romanov-split"},{year:1618,title:"Thirty Years War begins (Horde provinces vs Vatican)",type:"map",lat:50.08,lng:14.44,chapter:"11",phase:"romanov-split"},{year:1627,title:"Deep State erases Russian Empire from chronology",type:"map",lat:55.75,lng:37.62,chapter:"11",phase:"romanov-split"},{year:1642,title:"English Civil War begins",type:"map",lat:51.51,lng:-.13,chapter:"11",phase:"romanov-split"},{year:1648,title:"Cossack-Polish War — ethnic cleansing in Ukraine",type:"map",lat:50.45,lng:30.52,chapter:"11",phase:"romanov-split"},{year:1664,title:"Great Comet of 1664",type:"map",lat:51.51,lng:-.13,chapter:"11",phase:"romanov-split"},{year:1666,title:"London burns / Sabbatean crisis / Apocalypse of 1666",type:"map",lat:51.51,lng:-.13,chapter:"11",phase:"romanov-split"},{year:1694,title:"Bank of England — central banking solidified",type:"map",lat:51.51,lng:-.13,chapter:"11",phase:"romanov-split"},{year:1718,title:"Secret Society of Jesus goes public",type:"map",lat:51.51,lng:-.13,chapter:"12",phase:"collapse"},{year:1773,title:"Pugachev Rebellion — Final Tartary vs Romanov war",type:"map",lat:51.67,lng:55.1,chapter:"12",phase:"collapse"},{year:1774,title:"Carbon-14 spike / MudFlood begins",type:"map",lat:55.75,lng:37.62,chapter:"12",phase:"collapse"},{year:1803,title:"Napoleonic Wars begin",type:"map",lat:48.86,lng:2.35,chapter:"13",phase:"post-horde"},{year:1812,title:"Napoleon invades Russia",type:"map",lat:55.75,lng:37.62,chapter:"13",phase:"post-horde"},{year:1840,title:"Ecliptic pathway of the Absu last seen",type:"map",lat:55.75,lng:37.62,chapter:"13",phase:"post-horde"},{year:1848,title:"Battle for Communism's Soul: Marx vs Kinkel",type:"map",lat:50.94,lng:6.96,chapter:"13",phase:"post-horde"},{year:1883,title:"Hijacking of Communism",type:"map",lat:51.51,lng:-.13,chapter:"13",phase:"post-horde"},{year:1917,title:"Bolshevik Revolution",type:"map",lat:59.93,lng:30.32,chapter:"14",phase:"modern"}],X=[{id:"pre-empire",label:"No Empires / No Borders",yearStart:1053,yearEnd:1149,color:"#888888",opacity:.1},{id:"empire-formation",label:"Rus-Horde Formation",yearStart:1150,yearEnd:1299,color:"#c62828",opacity:.3},{id:"peak-empire",label:"Great Tartary — Peak Expansion",yearStart:1300,yearEnd:1399,color:"#b71c1c",opacity:.45},{id:"fragmentation",label:"Regional Fragmentation — Ottoman/Spain/Habsburg",yearStart:1400,yearEnd:1499,color:"#e65100",opacity:.35},{id:"religious-schism",label:"Protestant vs Orthodox Schism",yearStart:1500,yearEnd:1599,color:"#f57f17",opacity:.35},{id:"romanov-split",label:"Romanov Takeover — Empire Fractures",yearStart:1600,yearEnd:1699,color:"#ff6f00",opacity:.3},{id:"collapse",label:"Final Collapse — Pugachev / MudFlood",yearStart:1700,yearEnd:1799,color:"#4e342e",opacity:.3},{id:"post-horde",label:"Post-Horde — Nation-States Emerge",yearStart:1800,yearEnd:1899,color:"#37474f",opacity:.2},{id:"modern",label:"Modern Borders",yearStart:1900,yearEnd:2026,color:"#263238",opacity:.15}],re=[{id:"before-creation",yearStart:-5e3,yearEnd:-4077,label:"Before Creation",description:"Chaotic plasma environment. Saturn coalescing. Proto-configuration forming.",saturn:{glow:.3,rings:!1,position:[0,2,0]},venus:null,mars:null,earth:null,skyColor:"#1a0a2e"},{id:"golden-age",yearStart:-4077,yearEnd:-3147,label:"Golden Age — Collinear Configuration",description:"Saturn-Venus-Mars-Earth aligned. Tree of Life visible. Northern: Wheel of Heaven. Southern: Petroglyph figures.",saturn:{glow:1,rings:!1,position:[0,4,0],color:"#ffcc00"},venus:{type:"plasmoid",points:8,position:[0,2,0],color:"#ffffff"},mars:{type:"solid",position:[0,.5,0],color:"#cc3300"},earth:{position:[0,-1.5,0],color:"#3366cc"},skyColor:"#0d1b4a",yearLength:225},{id:"breakup",yearStart:-3147,yearEnd:-3067,label:"Collinear Configuration Breaks Apart",description:"All 9 planets break from configuration. Exit Saturn's plasma sheath.",saturn:{glow:.6,rings:!1,position:[0,5,0]},venus:{type:"plasmoid",points:6,position:[2,3,1],color:"#ffffff"},mars:{type:"solid",position:[-1,1,2],color:"#cc3300"},earth:{position:[-3,-1,-2],color:"#3366cc"},skyColor:"#2d0a0a",chaotic:!0},{id:"round-table",yearStart:-3067,yearEnd:-2349,label:"Non-Linear 'Round Table' — Jupiter Dominates",description:"Jupiter's 'Round Table' configuration. Planets in circular mini-orbit around Sun.",saturn:{glow:.3,rings:!1,position:[3,2,0]},venus:{type:"comet",position:[-2,1,3],color:"#ffeeaa"},mars:{type:"solid",position:[1,0,-2],color:"#cc3300"},earth:{position:[-1,-1,1],color:"#3366cc"},jupiter:{type:"dominant",position:[0,3,0],color:"#cc9944"},skyColor:"#1a0505",yearLength:273},{id:"deluge",yearStart:-2349,yearEnd:-2193,label:"The Deluge — Jupiter Disappears, Venus Attacks",description:"Jupiter disappears. Venus attacks Earth. Catastrophic flooding.",saturn:{glow:.2,rings:!1,position:[5,3,0]},venus:{type:"comet",position:[.5,.5,0],color:"#ff4444",threatening:!0},mars:{type:"solid",position:[2,-1,3],color:"#cc3300"},earth:{position:[0,0,0],color:"#3366cc",flooding:!0},skyColor:"#330000",yearLength:273},{id:"post-deluge",yearStart:-2193,yearEnd:-1492,label:"Post-Deluge — Destabilization Continues",description:"Jupiter consumes Venus. Sodom & Gomorrah. Configuration widening.",saturn:{glow:.15,rings:!1,position:[6,4,0]},venus:{type:"consumed",position:[3,3,0]},mars:{type:"solid",position:[.5,0,-1],color:"#cc3300",closeApproach:!0},earth:{position:[0,0,0],color:"#3366cc"},skyColor:"#1a0505",yearLength:273},{id:"venus-returns",yearStart:-1492,yearEnd:-806,label:"Venus Returns as Comet — Exodus",description:"Passover of Comet Venus. Venus and Mars tethered as 'the dragon'.",saturn:{glow:.1,rings:!1,position:[8,5,0]},venus:{type:"comet",position:[-1,1,0],color:"#ffaa00"},mars:{type:"solid",position:[-.5,.8,0],color:"#cc3300",tetheredToVenus:!0},earth:{position:[0,0,0],color:"#3366cc"},skyColor:"#0a0a1a",yearLength:290},{id:"stabilization",yearStart:-806,yearEnd:-670,label:"Orbits Finalize — Mars Loses Outer Shell",description:"Mars, Earth, Mercury move to final orbits. Iron Age begins.",saturn:{glow:.08,rings:!0,position:[10,6,0]},venus:{type:"planet",position:[-3,0,0],color:"#ffcc88"},mars:{type:"solid",position:[2,0,0],color:"#cc3300",shedding:!0},earth:{position:[0,0,0],color:"#3366cc"},skyColor:"#0a1a2a",yearLength:350},{id:"modern-solar",yearStart:-670,yearEnd:1053,label:"Modern Solar System — Phantom Period (The Blip)",description:"Solar system stable. 7th c. BCE to 10th c. CE is phantom time per Fomenko.",saturn:{glow:.05,rings:!0,position:[12,7,0],color:"#ccaa66"},venus:{type:"planet",position:[-4,0,0],color:"#ffcc88"},mars:{type:"planet",position:[3,0,0],color:"#cc3300"},earth:{position:[0,0,0],color:"#3366cc"},skyColor:"#0a1a3a",yearLength:365}];function $(i){return i<0?`${Math.abs(i)} BCE`:`${i} CE`}function Me(i,n,t,r=25){return i.filter(a=>t==="map"?a.type==="map":a.type==="planetary"||a.type==="blip").filter(a=>Math.abs(a.year-n)<=r).sort((a,o)=>a.year-o.year)}let B=null;const we="https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png";async function Se(i,n){B||(B=(await pe(async()=>{const{default:m}=await import("./leaflet-src-CzM8vlq-.js").then(c=>c.l);return{default:m}},[])).default);const t=B.map(i,{center:[48,40],zoom:4,minZoom:2,maxZoom:10,zoomControl:!0,attributionControl:!1});B.tileLayer(we,{subdomains:"abcd",maxZoom:19}).addTo(t);const r=JSON.parse(n),a={},o=[];let e=1053;r.features.forEach(m=>{const c=m.properties,v=B.geoJSON(m,{style:()=>({color:ie(c.phase),weight:2,opacity:0,fillColor:ie(c.phase),fillOpacity:0,dashArray:c.subRegion?"5,5":null})});v.bindTooltip(c.label||c.name,{className:"empire-tooltip",direction:"center",permanent:!1}),v.addTo(t),a[c.name]={layer:v,props:c}}),ce.filter(m=>m.type==="map"&&m.lat).forEach(m=>{const c=B.divIcon({className:"pulse-marker",iconSize:[12,12]}),v=B.marker([m.lat,m.lng],{icon:c,opacity:0});v.bindPopup(`<div class="event-popup">
        <h3>${m.title}</h3>
        <p class="year">${$(m.year)}</p>
      </div>`,{maxWidth:250}),v.addTo(t),o.push({marker:v,evt:m})});function s(m){e=m,Object.values(a).forEach(({layer:c,props:v})=>{const x=m>=v.yearStart&&m<=v.yearEnd,C=X.find(z=>z.id===v.phase);let D=0;if(x){const z=v.yearEnd-v.yearStart,R=m-v.yearStart,E=v.yearEnd-m,J=Math.min(50,z*.1),q=Math.min(1,R/J),Z=Math.min(1,E/J);D=Math.min(q,Z)*(C?C.opacity:.3)}c.setStyle({opacity:x?.7:0,fillOpacity:D})}),o.forEach(({marker:c,evt:v})=>{const x=Math.abs(v.year-m)<=10,C=v.year<=m;c.setOpacity(C?x?1:.3:0)})}function y(){const m=X.find(c=>e>=c.yearStart&&e<=c.yearEnd);return m?m.label:""}function S(){t.remove()}return{map:t,setYear:s,getPhaseLabel:y,destroy:S}}function ie(i){const n=X.find(t=>t.id===i);return n?n.color:"#888"}let h=null;const A=-3147,Q=.8,w={R:8,period:1,saturn:{dy:5},venus:{dy:3,wr:.3,wp:.615},mars:{dy:1.5,wr:.2,wp:1.88},earth:{dy:0,wr:.15,wp:1}},f={sunPos:[-8,-3,0],saturn:{rx:5,ry:3.5,tilt:.2,period:10},venus:{rx:3.5,ry:2,tilt:.5,period:.615},mars:{rx:3,ry:2.5,tilt:-.3,period:1.88},earth:{rx:2.2,ry:1.5,tilt:-.1,period:1}},M={venus:{r:3.5,period:.615},earth:{r:5,period:1},mars:{r:7,period:1.88},jupiter:{r:10,period:11.86},saturn:{r:13,period:29.46}};async function xe(i){h||(h=await pe(()=>import("./three.module-BtCAaDxU.js"),[]));const n=new h.Scene,t=new h.PerspectiveCamera(60,i.clientWidth/i.clientHeight,.1,1e3);t.position.set(0,10,25),t.lookAt(0,2,0);const r=new h.WebGLRenderer({canvas:i,antialias:!0,alpha:!0});r.setSize(i.clientWidth,i.clientHeight),r.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.toneMapping=h.ACESFilmicToneMapping,r.toneMappingExposure=1.4,n.add(new h.AmbientLight(8952251,1.4));const a=new h.PointLight(16777164,3,100);a.position.set(0,0,0),n.add(a);const o=new h.DirectionalLight(11189196,.6);o.position.set(0,5,15),n.add(o);const e={};ke(n,e,h),Le(n,e,h),Ae(n,e,h),Be(n,e,h),je(n,e,h),Fe(n,e,h),Oe(n,e,h);const d=Ge(n,h);ze(n,h);const s={};s.sun=j("SUN","#ffffaa",h),s.saturn=j("SATURN","#ff8833",h),s.venus=j("VENUS","#33ff77",h),s.mars=j("MARS","#ff6644",h),s.earth=j("EARTH","#66aaff",h),s.jupiter=j("JUPITER","#ffaa44",h),s.moon=j("MOON","#cccccc",h),Object.values(s).forEach(l=>n.add(l));const y={};y.collinear=Pe(n,h),y.roundTable=Ce(n,h),y.modern=Ie(n,h),V(y.collinear,!1),V(y.roundTable,!1),V(y.modern,!1);let S=-5e3,m="",c={},v=null,x=new h.Vector3(0,10,25),C=new h.Vector3(0,2,0);const D=()=>{const l=i.clientWidth,p=i.clientHeight;!l||!p||(t.aspect=l/p,t.updateProjectionMatrix(),r.setSize(l,p))};window.addEventListener("resize",D);function z(){var l,p,u,b,g;v=requestAnimationFrame(z),e.sun&&(e.sun.rotation.y+=.001),(l=e.saturn)!=null&&l.visible&&(e.saturn.rotation.y+=.002),(p=e.venus)!=null&&p.visible&&(e.venus.rotation.y+=.005),(u=e.mars)!=null&&u.visible&&(e.mars.rotation.y+=.004),(b=e.earth)!=null&&b.visible&&(e.earth.rotation.y+=.003),(g=e.jupiter)!=null&&g.visible&&(e.jupiter.rotation.y+=.001),d!=null&&d.visible&&(d.rotation.y+=5e-4,d.rotation.x=Math.sin(performance.now()*1e-4)*.05),t.position.lerp(x,.03),t.lookAt(C),F(s.sun,e.sun,1.4,t),F(s.saturn,e.saturn,1.8,t),F(s.venus,e.venus,.8,t),F(s.mars,e.mars,.7,t),F(s.earth,e.earth,.8,t),F(s.jupiter,e.jupiter,1.4,t),F(s.moon,e.moon,.4,t),r.render(n,t)}z();function R(l){S=l;const p=re.find(k=>l>=k.yearStart&&l<=k.yearEnd);if(!p)return;n.background=new h.Color(p.skyColor);const u=p.yearLength||365,b=l-p.yearStart;let g="none";if(p.id==="golden-age"?g="collinear":p.id==="round-table"?g="roundTable":(p.id==="stabilization"||p.id==="modern-solar")&&(g="modern"),g!==m&&(V(y.collinear,g==="collinear"),V(y.roundTable,g==="roundTable"),V(y.modern,g==="modern"),m=g,g==="collinear"?(x.set(0,12,26),C.set(0,2,0)):g==="roundTable"?(x.set(0,8,20),C.set(0,0,0)):g==="modern"?(x.set(0,24,24),C.set(0,0,0)):(x.set(0,8,22),C.set(0,1,0))),e.sun.visible=!0,s.sun.visible=!0,g==="collinear"?E(b,p):g==="roundTable"?J(b,p):g==="modern"?q(b,p):Z(p),l>=A&&e.earth.visible){e.moon.visible=!0,s.moon.visible=!0;const k=Math.min(1,(l-A)/(-670-A)),N=10+(27.3-10)*k,K=(l-A)*u/N*Math.PI*2;e.moon.position.set(e.earth.position.x+Q*Math.cos(K),e.earth.position.y+Q*Math.sin(K)*.25,e.earth.position.z+Q*Math.sin(K))}else e.moon.visible=!1,s.moon.visible=!1;if(d.visible=l<-806,d.visible&&(d.material.opacity=Math.max(0,Math.min(1,(-l-670)/2477))*.6),c={},g==="collinear"?(c.earth=Math.abs(b),c.venus=Math.abs(b/.615),c.mars=Math.abs(b/1.88)):g==="roundTable"?(c.earth=Math.abs(b),c.venus=Math.abs(b/.615),c.mars=Math.abs(b/1.88),c.saturn=Math.abs(b/10)):g==="modern"&&(c.earth=Math.abs(b),c.venus=Math.abs(b/.615),c.mars=Math.abs(b/1.88),c.jupiter=Math.abs(b/11.86),c.saturn=Math.abs(b/29.46)),l>=A){const k=Math.min(1,(l-A)/(-670-A)),N=10+(27.3-10)*k;c.moon=Math.abs((l-A)*u/N)}}function E(l,p){var k,N;const u=l/w.period*Math.PI*2,b=w.R*Math.cos(u),g=w.R*Math.sin(u);if(e.sun.position.set(0,0,0),a.position.set(0,0,0),e.saturn.visible=!0,s.saturn.visible=!0,e.saturn.position.set(b,w.saturn.dy,g),e.saturnGlow.material.opacity=(((k=p.saturn)==null?void 0:k.glow)||.5)*.6,e.saturnRings.material.opacity=(N=p.saturn)!=null&&N.rings?.5:0,p.venus){e.venus.visible=!0,s.venus.visible=!0;const L=l/w.venus.wp*Math.PI*2;e.venus.position.set(b+w.venus.wr*Math.cos(L),w.venus.dy,g+w.venus.wr*Math.sin(L))}else e.venus.visible=!1,s.venus.visible=!1;if(p.mars){e.mars.visible=!0,s.mars.visible=!0;const L=l/w.mars.wp*Math.PI*2;e.mars.position.set(b+w.mars.wr*Math.cos(L),w.mars.dy,g+w.mars.wr*Math.sin(L))}else e.mars.visible=!1,s.mars.visible=!1;if(p.earth){e.earth.visible=!0,s.earth.visible=!0;const L=l/w.earth.wp*Math.PI*2;e.earth.position.set(b+w.earth.wr*Math.cos(L),w.earth.dy,g+w.earth.wr*Math.sin(L))}else e.earth.visible=!1,s.earth.visible=!1;e.jupiter.visible=!1,s.jupiter.visible=!1}function J(l,p){if(e.sun.position.set(...f.sunPos),a.position.set(...f.sunPos),e.jupiter.visible=!0,s.jupiter.visible=!0,e.jupiter.position.set(0,0,0),p.saturn){e.saturn.visible=!0,s.saturn.visible=!0;const u=l/f.saturn.period*Math.PI*2;e.saturn.position.set(f.saturn.rx*Math.cos(u),f.saturn.ry*Math.sin(u)*Math.cos(f.saturn.tilt),f.saturn.ry*Math.sin(u)*Math.sin(f.saturn.tilt)),e.saturnGlow.material.opacity=(p.saturn.glow||.3)*.6,e.saturnRings.material.opacity=p.saturn.rings?.5:0}if(p.venus){e.venus.visible=!0,s.venus.visible=!0;const u=l/f.venus.period*Math.PI*2;e.venus.position.set(f.venus.rx*Math.cos(u),f.venus.ry*Math.sin(u)*Math.cos(f.venus.tilt),f.venus.ry*Math.sin(u)*Math.sin(f.venus.tilt))}else e.venus.visible=!1,s.venus.visible=!1;if(p.mars){e.mars.visible=!0,s.mars.visible=!0;const u=l/f.mars.period*Math.PI*2;e.mars.position.set(f.mars.rx*Math.cos(u),f.mars.ry*Math.sin(u)*Math.cos(f.mars.tilt),f.mars.ry*Math.sin(u)*Math.sin(f.mars.tilt))}else e.mars.visible=!1,s.mars.visible=!1;if(p.earth){e.earth.visible=!0,s.earth.visible=!0;const u=l/f.earth.period*Math.PI*2;e.earth.position.set(f.earth.rx*Math.cos(u),f.earth.ry*Math.sin(u)*Math.cos(f.earth.tilt),f.earth.ry*Math.sin(u)*Math.sin(f.earth.tilt))}else e.earth.visible=!1,s.earth.visible=!1}function q(l,p){if(e.sun.position.set(0,0,0),a.position.set(0,0,0),p.venus){e.venus.visible=!0,s.venus.visible=!0;const u=l/M.venus.period*Math.PI*2;e.venus.position.set(M.venus.r*Math.cos(u),0,M.venus.r*Math.sin(u))}else e.venus.visible=!1,s.venus.visible=!1;if(p.earth){e.earth.visible=!0,s.earth.visible=!0;const u=l/M.earth.period*Math.PI*2;e.earth.position.set(M.earth.r*Math.cos(u),0,M.earth.r*Math.sin(u))}else e.earth.visible=!1,s.earth.visible=!1;if(p.mars){e.mars.visible=!0,s.mars.visible=!0;const u=l/M.mars.period*Math.PI*2;e.mars.position.set(M.mars.r*Math.cos(u),0,M.mars.r*Math.sin(u))}else e.mars.visible=!1,s.mars.visible=!1;if(p.jupiter){e.jupiter.visible=!0,s.jupiter.visible=!0;const u=l/M.jupiter.period*Math.PI*2;e.jupiter.position.set(M.jupiter.r*Math.cos(u),0,M.jupiter.r*Math.sin(u))}else e.jupiter.visible=!1,s.jupiter.visible=!1;if(p.saturn){e.saturn.visible=!0,s.saturn.visible=!0;const u=l/M.saturn.period*Math.PI*2;e.saturn.position.set(M.saturn.r*Math.cos(u),0,M.saturn.r*Math.sin(u)),e.saturnGlow.material.opacity=(p.saturn.glow||.05)*.6,e.saturnRings.material.opacity=p.saturn.rings?.5:0}}function Z(l){e.sun.position.set(0,-3,-5),a.position.set(0,-3,-5);const p=(u,b)=>{b&&u.position.lerp(new h.Vector3(b[0],b[1],b[2]),.05)};l.saturn&&(e.saturn.visible=!0,s.saturn.visible=!0,p(e.saturn,l.saturn.position),e.saturnGlow.material.opacity=(l.saturn.glow||.3)*.6,e.saturnRings.material.opacity=l.saturn.rings?.5:0),l.venus?(e.venus.visible=!0,s.venus.visible=!0,p(e.venus,l.venus.position)):(e.venus.visible=!1,s.venus.visible=!1),l.mars?(e.mars.visible=!0,s.mars.visible=!0,p(e.mars,l.mars.position)):(e.mars.visible=!1,s.mars.visible=!1),l.earth?(e.earth.visible=!0,s.earth.visible=!0,p(e.earth,l.earth.position)):(e.earth.visible=!1,s.earth.visible=!1),l.jupiter?(e.jupiter.visible=!0,s.jupiter.visible=!0,p(e.jupiter,l.jupiter.position)):(e.jupiter.visible=!1,s.jupiter.visible=!1)}function ye(){const l=re.find(p=>S>=p.yearStart&&S<=p.yearEnd);return l?{label:l.label,description:l.description}:{label:"",description:""}}function fe(){return{...c}}function be(){v&&cancelAnimationFrame(v),window.removeEventListener("resize",D),r.dispose()}return{setYear:R,getPhaseInfo:ye,getOrbitInfo:fe,destroy:be}}function j(i,n,t){const r=document.createElement("canvas"),a=r.getContext("2d");r.width=256,r.height=64,a.clearRect(0,0,r.width,r.height),a.font="bold 48px Arial, sans-serif",a.textAlign="center",a.textBaseline="middle",a.shadowColor="rgba(0,0,0,0.8)",a.shadowBlur=6,a.fillStyle=n,a.fillText(i,r.width/2,r.height/2);const o=new t.CanvasTexture(r);o.minFilter=t.LinearFilter;const e=new t.Sprite(new t.SpriteMaterial({map:o,transparent:!0,depthTest:!1}));return e.scale.set(2.5,.6,1),e.visible=!1,e}function F(i,n,t,r){!(i!=null&&i.visible)||!(n!=null&&n.visible)||(i.position.set(n.position.x,n.position.y+t,n.position.z),i.quaternion.copy(r.quaternion))}function ee(i,n,t,r){const a=new r.BufferGeometry().setFromPoints(i),o=new r.LineBasicMaterial({color:n,transparent:!0,opacity:t,depthWrite:!1});return new r.Line(a,o)}function V(i,n){Array.isArray(i)?i.forEach(t=>{t.visible=n}):i&&(i.visible=n)}function Pe(i,n){const t=[];for(let a=0;a<=96;a++){const o=a/96*Math.PI*2;t.push(new n.Vector3(w.R*Math.cos(o),0,w.R*Math.sin(o)))}const r=ee(t,16746547,.3,n);return i.add(r),[r]}function Ce(i,n){const t=[],r=[{...f.saturn,color:16746547},{...f.venus,color:3407735},{...f.mars,color:16737860},{...f.earth,color:6728447}];for(const a of r){const o=[];for(let d=0;d<=80;d++){const s=d/80*Math.PI*2;o.push(new n.Vector3(a.rx*Math.cos(s),a.ry*Math.sin(s)*Math.cos(a.tilt),a.ry*Math.sin(s)*Math.sin(a.tilt)))}const e=ee(o,a.color,.25,n);i.add(e),t.push(e)}return t}function Ie(i,n){const t=[],r=[{r:M.venus.r,color:3407735},{r:M.earth.r,color:6728447},{r:M.mars.r,color:16737860},{r:M.jupiter.r,color:16755268},{r:M.saturn.r,color:16746547}];for(const a of r){const o=[];for(let d=0;d<=96;d++){const s=d/96*Math.PI*2;o.push(new n.Vector3(a.r*Math.cos(s),0,a.r*Math.sin(s)))}const e=ee(o,a.color,.25,n);i.add(e),t.push(e)}return t}function G(i,n){const r=document.createElement("canvas");r.width=128,r.height=128;const a=r.getContext("2d"),o=new n.Color(i),e=Math.round(o.r*255),d=Math.round(o.g*255),s=Math.round(o.b*255),y=a.createRadialGradient(128/2,128/2,0,128/2,128/2,128/2);return y.addColorStop(0,`rgba(${e},${d},${s},1)`),y.addColorStop(.3,`rgba(${e},${d},${s},0.5)`),y.addColorStop(1,`rgba(${e},${d},${s},0)`),a.fillStyle=y,a.fillRect(0,0,128,128),new n.CanvasTexture(r)}function ke(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.8,32,32),new t.MeshStandardMaterial({color:16777164,emissive:16768324,emissiveIntensity:1.5,roughness:0}));r.position.set(0,0,0),i.add(r),n.sun=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(16768324,t),color:16768324,transparent:!0,opacity:.7,blending:t.AdditiveBlending}));a.scale.set(5,5,1),r.add(a)}function Le(i,n,t){const r=new t.Mesh(new t.SphereGeometry(1.2,32,32),new t.MeshStandardMaterial({color:16746547,emissive:13395490,emissiveIntensity:.8,roughness:.3}));r.position.set(0,5,0),i.add(r),n.saturn=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(16746547,t),color:16746547,transparent:!0,opacity:.6,blending:t.AdditiveBlending}));a.scale.set(5,5,1),r.add(a),n.saturnGlow=a;const o=new t.Mesh(new t.RingGeometry(1.6,2.4,64),new t.MeshBasicMaterial({color:13412966,side:t.DoubleSide,transparent:!0,opacity:0}));o.rotation.x=Math.PI/2.3,r.add(o),n.saturnRings=o}function Ae(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.4,16,16),new t.MeshStandardMaterial({color:3407735,emissive:2280533,emissiveIntensity:1,roughness:0}));r.position.set(0,3,0),i.add(r),n.venus=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(3407735,t),color:3407735,transparent:!0,opacity:.5,blending:t.AdditiveBlending}));a.scale.set(3,3,1),r.add(a),n.venusGlow=a}function Be(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.35,16,16),new t.MeshStandardMaterial({color:16729122,emissive:13382400,emissiveIntensity:.6,roughness:.6,metalness:.2}));r.position.set(0,1.5,0),i.add(r),n.mars=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(16729122,t),color:16729122,transparent:!0,opacity:.25,blending:t.AdditiveBlending}));a.scale.set(1.5,1.5,1),r.add(a)}function je(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.45,24,24),new t.MeshStandardMaterial({color:4491519,emissive:2245802,emissiveIntensity:.5,roughness:.4,metalness:.1}));r.position.set(0,0,0),i.add(r),n.earth=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(4491519,t),color:4491519,transparent:!0,opacity:.2,blending:t.AdditiveBlending}));a.scale.set(1.8,1.8,1),r.add(a)}function Fe(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.9,24,24),new t.MeshStandardMaterial({color:14527044,emissive:8939042,emissiveIntensity:.5,roughness:.5}));r.visible=!1,i.add(r),n.jupiter=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(14527044,t),color:14527044,transparent:!0,opacity:.3,blending:t.AdditiveBlending}));a.scale.set(3,3,1),r.add(a)}function Oe(i,n,t){const r=new t.Mesh(new t.SphereGeometry(.15,16,16),new t.MeshStandardMaterial({color:12303291,emissive:6710886,emissiveIntensity:.3,roughness:.8}));r.visible=!1,i.add(r),n.moon=r;const a=new t.Sprite(new t.SpriteMaterial({map:G(11184810,t),color:11184810,transparent:!0,opacity:.15,blending:t.AdditiveBlending}));a.scale.set(.6,.6,1),r.add(a)}function Ge(i,n){const r=new Float32Array(6e3),a=new Float32Array(2e3*3);for(let s=0;s<2e3;s++){const y=Math.random()*Math.PI*2,S=Math.random()*Math.PI,m=6+Math.random()*3;r[s*3]=m*Math.sin(S)*Math.cos(y),r[s*3+1]=m*Math.cos(S),r[s*3+2]=m*Math.sin(S)*Math.sin(y),a[s*3]=.3+Math.random()*.3,a[s*3+1]=.1+Math.random()*.2,a[s*3+2]=.5+Math.random()*.5}const o=new n.BufferGeometry;o.setAttribute("position",new n.BufferAttribute(r,3)),o.setAttribute("color",new n.BufferAttribute(a,3));const e=new n.PointsMaterial({size:.08,vertexColors:!0,transparent:!0,opacity:.6,blending:n.AdditiveBlending,depthWrite:!1}),d=new n.Points(o,e);return i.add(d),d}function ze(i,n){const r=new Float32Array(15e3);for(let o=0;o<5e3;o++)r[o*3]=(Math.random()-.5)*200,r[o*3+1]=(Math.random()-.5)*200,r[o*3+2]=(Math.random()-.5)*200;const a=new n.BufferGeometry;a.setAttribute("position",new n.BufferAttribute(r,3)),i.add(new n.Points(a,new n.PointsMaterial({size:.1,color:16777215,transparent:!0,opacity:.6})))}const Ne=`{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Rus-Horde Core",
        "phase": "empire-formation",
        "yearStart": 1150,
        "yearEnd": 1775,
        "label": "Great Tartary / Mongol Empire",
        "fomenkoName": "Rus-Horde"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [30, 45], [35, 42], [40, 38], [45, 40], [50, 42],
          [55, 43], [60, 45], [70, 48], [80, 50], [90, 52],
          [100, 53], [110, 52], [120, 50], [130, 48],
          [135, 45], [130, 55], [120, 60], [110, 62],
          [100, 63], [90, 64], [80, 65], [70, 66],
          [60, 65], [50, 63], [45, 60], [40, 58],
          [35, 55], [30, 52], [28, 48], [30, 45]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Ottoman Region",
        "phase": "fragmentation",
        "yearStart": 1400,
        "yearEnd": 1922,
        "label": "Ottoman Empire (= Ataman/Horde Province)",
        "fomenkoName": "Ataman",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [20, 35], [25, 33], [30, 32], [35, 33],
          [40, 35], [42, 37], [40, 40], [35, 42],
          [30, 43], [27, 42], [25, 40], [22, 38],
          [20, 36], [20, 35]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Spain / Iberia",
        "phase": "fragmentation",
        "yearStart": 1400,
        "yearEnd": 1700,
        "label": "Spain (= Horde Colony per Fomenko)",
        "fomenkoName": "Horde Colony — Iberia",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [-10, 36], [-9, 37], [-8, 39], [-7, 41],
          [-5, 43], [-2, 43], [0, 42], [2, 42],
          [3, 40], [1, 38], [-1, 37], [-3, 36],
          [-5, 36], [-7, 36], [-10, 36]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Habsburg Territories",
        "phase": "fragmentation",
        "yearStart": 1450,
        "yearEnd": 1800,
        "label": "Habsburg / Holy Roman Empire",
        "fomenkoName": "Western Horde Province",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [5, 46], [8, 44], [12, 44], [15, 45],
          [17, 46], [20, 47], [22, 48], [20, 50],
          [18, 51], [15, 52], [12, 51], [10, 50],
          [7, 49], [5, 48], [5, 46]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Protestant Zone",
        "phase": "religious-schism",
        "yearStart": 1517,
        "yearEnd": 1700,
        "label": "Protestant Territories",
        "conflictType": "protestant-vs-orthodox",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [5, 52], [8, 50], [12, 49], [15, 50],
          [10, 55], [8, 56], [5, 55], [3, 54],
          [5, 52]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Eastern Orthodox Zone",
        "phase": "religious-schism",
        "yearStart": 1053,
        "yearEnd": 1700,
        "label": "Eastern Orthodox Territories",
        "conflictType": "protestant-vs-orthodox",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [25, 42], [30, 40], [35, 42], [40, 45],
          [45, 50], [50, 55], [45, 58], [40, 60],
          [35, 58], [30, 55], [28, 50], [25, 46],
          [25, 42]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Muscovy (Romanov Split)",
        "phase": "romanov-split",
        "yearStart": 1613,
        "yearEnd": 1917,
        "label": "Muscovy / Romanov Russia",
        "fomenkoName": "Romanov rebel state",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [28, 52], [32, 50], [38, 50], [42, 52],
          [48, 55], [50, 58], [48, 62], [42, 64],
          [36, 63], [32, 60], [30, 57], [28, 55],
          [28, 52]
        ]]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "British Empire Zone",
        "phase": "romanov-split",
        "yearStart": 1583,
        "yearEnd": 1997,
        "label": "British Empire (Deep State Instrument)",
        "subRegion": true
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [-8, 50], [-6, 50], [-5, 51], [-3, 52],
          [0, 53], [2, 52], [2, 51], [0, 50],
          [-2, 50], [-4, 49], [-6, 49], [-8, 50]
        ]]
      }
    }
  ]
}
`;let O=1053,P="map",U=!1,Y=null,ue=80,T=null,H=null;const I=document.getElementById("timeline-slider"),de=document.getElementById("btn-map"),me=document.getElementById("btn-3d"),te=document.getElementById("btn-play"),ae=document.getElementById("btn-pause"),Ve=document.getElementById("btn-reset"),se=document.getElementById("speed-select"),_e=document.getElementById("map-view"),De=document.getElementById("planet-view"),$e=document.getElementById("map-year-display"),Je=document.getElementById("map-phase-label"),Ye=document.getElementById("planet-year-display"),We=document.getElementById("planet-phase-label"),Ue=document.getElementById("planet-description"),Re=document.getElementById("event-feed"),Ee=document.getElementById("timeline-markers");document.addEventListener("DOMContentLoaded",async()=>{T=await Se(document.getElementById("map"),Ne),H=await xe(document.getElementById("planet-canvas")),he(),_(O),qe()});function qe(){de.addEventListener("click",()=>oe("map")),me.addEventListener("click",()=>oe("3d")),I.addEventListener("input",()=>{_(parseInt(I.value,10))}),te.addEventListener("click",le),ae.addEventListener("click",W),Ve.addEventListener("click",()=>{W(),_(P==="map"?1053:-5e3)}),se.addEventListener("change",()=>{ue=parseInt(se.value,10),U&&(W(),le())})}function oe(i){P=i,de.classList.toggle("active",P==="map"),me.classList.toggle("active",P==="3d"),_e.classList.toggle("active",P==="map"),De.classList.toggle("active",P==="3d"),P==="map"?(I.min=1053,I.max=2026,O<1053&&_(1053)):(I.min=-5e3,I.max=1053,O>1053&&_(-4077)),I.value=O,he()}function _(i){if(O=i,I.value=i,P==="map")T.setYear(i),$e.textContent=$(i),Je.textContent=T.getPhaseLabel();else{H.setYear(i);const n=H.getPhaseInfo();Ye.textContent=$(i),We.textContent=n.label,Ue.textContent=n.description}Ze(i)}function le(){if(U)return;U=!0,te.style.display="none",ae.style.display="";const i=P==="map"?1:O<-3e3?10:5,n=P==="map"?2026:1053;Y=setInterval(()=>{const t=O+i;if(t>n){W();return}_(t)},ue)}function W(){U=!1,te.style.display="",ae.style.display="none",Y&&(clearInterval(Y),Y=null)}function Ze(i){const n=Me(ce,i,P);Re.innerHTML=n.map(t=>`<div class="event-item ${Math.abs(t.year-i)<=5?"active":""}">${$(t.year)} — ${t.title}</div>`).join("")}function he(){const i=parseInt(I.min,10),n=parseInt(I.max,10),t=P==="map"?100:500,r=[];for(let a=i;a<=n;a+=t)r.push(`<span>${$(a)}</span>`);Ee.innerHTML=r.join("")}
